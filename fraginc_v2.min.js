const fragAddress="TPpLkxGeKragRC7qpiQjjtNmf6shXWi8i9",contractAddress="THY2dFejdnvANCBuA9fJ5XH2FKXd6pa19f";let myaddress,refferal,contractInstance,fragInstance,sellFee=[],unitCount=[],loaded=!1;Promise.queue=function a(a){return new Promise(function(b,c){const d=[];let e=0;const f=setInterval(async function(){e++;const g=[];for(let b=0;3>b;b++)0<a.length&&g.push(a.shift()());const h=await Promise.all(g);h.forEach(a=>d.push(a)),0==a.length&&(clearInterval(f),b(d)),10<=e&&c("more than 10 tries")},700)})};function roundToFour(a){return+(Math.floor(a+"e+4")+"e-4")}function roundToTwo(a){return+(Math.floor(a+"e+2")+"e-2")}function round(a){return+(Math.floor(a+"e+0")+"e-0")}function roundToTwoOrFour(a){return 1>a?roundToFour(a):roundToTwo(a)}function kOrMi(a){return 999<a?roundToTwo(a/1e3)+" K":999999<a?roundToTwo(a/1e6)+" Mi":roundToTwo(a)}const accountInterval1=setInterval(async function(){if(myaddress!=tronWeb.defaultAddress.base58){!1==myaddress&&!1!=tronWeb.defaultAddress.base58&&location.reload(),myaddress=tronWeb.defaultAddress.base58,contractInstance===void 0&&(contractInstance=await tronWeb.contract().at(contractAddress),fragInstance=await tronWeb.contract().at(fragAddress),refferal=getUrlVars().ref||tronWeb.defaultAddress.base58,console.log(refferal),putvalues(),loadOneTime());setInterval(async function(){myaddress==tronWeb.defaultAddress.base58?contractInstance===void 0?(contractInstance=await tronWeb.contract().at(contractAddress),fragInstance=await tronWeb.contract().at(fragAddress),refferal=getUrlVars().ref||tronWeb.defaultAddress.base58,console.log(refferal),putvalues()):(putvalues(),!loaded&&loadOneTime()):(!1==myaddress&&!1!=tronWeb.defaultAddress.base58&&location.reload(),myaddress=tronWeb.defaultAddress.base58,putvalues())},7e3);clearInterval(accountInterval1)}},3e3);async function putvalues(){const[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z]=await Promise.queue([contractInstance.unclaimed(myaddress).call,contractInstance.calculateGains(myaddress).call,contractInstance.getPlayerUnitsById(0,myaddress).call,contractInstance.getPlayerUnitsById(1,myaddress).call,contractInstance.getPlayerUnitsById(2,myaddress).call,contractInstance.getPlayerUnitsById(3,myaddress).call,contractInstance.getUnitSharesById(0).call,contractInstance.getUnitSharesById(1).call,contractInstance.getUnitSharesById(2).call,contractInstance.getUnitSharesById(3).call,contractInstance.getUnitCookiesPerSecond(0).call,contractInstance.getUnitCookiesPerSecond(1).call,contractInstance.getUnitCookiesPerSecond(2).call,contractInstance.getUnitCookiesPerSecond(3).call,contractInstance.getUnitPrice(0).call,contractInstance.getUnitPrice(1).call,contractInstance.getUnitPrice(2).call,contractInstance.getUnitPrice(3).call,contractInstance.getCookiePot().call,contractInstance.getPlayerCookies(tronWeb.defaultAddress.base58).call,contractInstance.calculateCookieValueForPlayer().call,fragInstance.balanceOf(tronWeb.defaultAddress.base58).call,contractInstance.getUnitCountById(0).call,contractInstance.getUnitCountById(1).call,contractInstance.getUnitCountById(2).call,contractInstance.getUnitCountById(3).call]);document.getElementById("WithdrawbleFrag").innerHTML=roundToTwoOrFour((+a+ +b)/1e18),document.getElementById("YourUnits1").innerHTML=roundToTwoOrFour(c/1e4),document.getElementById("YourUnits2").innerHTML=roundToTwoOrFour(d/1e4),document.getElementById("YourUnits3").innerHTML=roundToTwoOrFour(e/1e4),document.getElementById("YourUnits4").innerHTML=roundToTwoOrFour(f/1e4),document.getElementById("ProdUnit1top").innerHTML=roundToTwo(k*c/1e4),document.getElementById("ProdUnit2top").innerHTML=roundToTwo(l*d/1e4),document.getElementById("ProdUnit3top").innerHTML=roundToTwo(m*e/1e4),document.getElementById("ProdUnit4top").innerHTML=roundToTwo(n*f/1e4),document.getElementById("unit1_prod").innerHTML=roundToTwo(k),document.getElementById("unit2_prod").innerHTML=roundToTwo(l),document.getElementById("unit3_prod").innerHTML=roundToTwo(m),document.getElementById("unit4_prod").innerHTML=roundToTwo(n),document.getElementById("YourShare1").innerHTML=roundToTwo(g*c/1e4),document.getElementById("YourShare2").innerHTML=roundToTwo(h*d/1e4),document.getElementById("YourShare3").innerHTML=roundToTwo(i*e/1e4),document.getElementById("YourShare4").innerHTML=roundToTwo(j*f/1e4),document.getElementById("unit1_shares").innerHTML=roundToTwo(g),document.getElementById("unit2_shares").innerHTML=roundToTwo(h),document.getElementById("unit3_shares").innerHTML=roundToTwo(i),document.getElementById("unit4_shares").innerHTML=roundToTwo(j),document.querySelectorAll("#BuyPriceUnit1").forEach(a=>a.innerHTML=roundToTwo(1e4*(o/1e18))),document.querySelectorAll("#BuyPriceUnit2").forEach(a=>a.innerHTML=roundToTwo(1e4*(p/1e18))),document.querySelectorAll("#BuyPriceUnit3").forEach(a=>a.innerHTML=roundToTwo(1e4*(q/1e18))),document.querySelectorAll("#BuyPriceUnit3").forEach(a=>a.innerHTML=roundToTwo(1e4*(q/1e18))),document.querySelectorAll("#BuyPriceUnit4").forEach(a=>a.innerHTML=roundToTwo(1e4*(r/1e18))),document.getElementById("FragBalance").innerHTML=roundToTwo(v/1e18),document.getElementById("cookiePot").innerHTML=roundToTwo(s/1e18),document.getElementById("your_cookies").innerHTML=kOrMi(t/1e4),document.getElementById("cookies_value").innerHTML=roundToTwoOrFour(u/1e18),document.getElementById("your_addy").innerHTML=myaddress.substring(0,3)+"..."+myaddress.substring(myaddress.length-4,myaddress.length),document.getElementById("your_prod").innerHTML=roundToTwo((k*c+l*d+m*e+n*f)/1e4),document.getElementById("your_shares").innerHTML=roundToTwo((g*c+h*d+i*e+j*f)/1e4),unitCount[0]=parseInt(w._hex,16)/1e4,unitCount[1]=parseInt(x._hex,16)/1e4,unitCount[2]=parseInt(y._hex,16)/1e4,unitCount[3]=parseInt(z._hex,16)/1e4,document.getElementById("totalUnits1").innerHTML=kOrMi(unitCount[0]),document.getElementById("totalUnits2").innerHTML=kOrMi(unitCount[1]),document.getElementById("totalUnits3").innerHTML=kOrMi(unitCount[2]),document.getElementById("totalUnits4").innerHTML=kOrMi(unitCount[3]),document.getElementById("totalShares1").innerHTML=kOrMi(w*g/1e4),document.getElementById("totalShares2").innerHTML=kOrMi(x*g/1e4),document.getElementById("totalShares3").innerHTML=kOrMi(y*g/1e4),document.getElementById("totalShares4").innerHTML=kOrMi(z*g/1e4)}async function loadOneTime(){const[a,b,c,d,e,f,g,h]=await Promise.queue([contractInstance.getUnitSellFee(0).call,contractInstance.getUnitSellFee(1).call,contractInstance.getUnitSellFee(2).call,contractInstance.getUnitSellFee(3).call,contractInstance.getUnitBuyFee(0).call,contractInstance.getUnitBuyFee(1).call,contractInstance.getUnitBuyFee(2).call,contractInstance.getUnitBuyFee(3).call]),[i,j,k,l]=await Promise.all([isUnitUnlocked(0),isUnitUnlocked(1),isUnitUnlocked(2),isUnitUnlocked(3)]);sellFee[0]=parseInt(a._hex,16),sellFee[1]=parseInt(b._hex,16),sellFee[2]=parseInt(c._hex,16),sellFee[3]=parseInt(d._hex,16),(a==null||b==null||c==null||d==null||e==null||f==null||g==null||h==null)&&loadOneTime(),document.querySelectorAll("#sellFee1").forEach(a=>a.innerHTML=sellFee[0]+"%"),document.querySelectorAll("#sellFee2").forEach(a=>a.innerHTML=sellFee[1]+"%"),document.querySelectorAll("#sellFee3").forEach(a=>a.innerHTML=sellFee[2]+"%"),document.querySelectorAll("#sellFee4").forEach(a=>a.innerHTML=sellFee[3]+"%"),document.querySelectorAll("#buyFee1").forEach(a=>a.innerHTML=parseInt(e._hex,16)+"%"),document.querySelectorAll("#buyFee2").forEach(a=>a.innerHTML=parseInt(f._hex,16)+"%"),document.querySelectorAll("#buyFee3").forEach(a=>a.innerHTML=parseInt(g._hex,16)+"%"),document.querySelectorAll("#buyFee4").forEach(a=>a.innerHTML=parseInt(h._hex,16)+"%"),i&&($("#isLocked1").hide(),$("#info1").show()),j&&($("#isLocked2").hide(),$("#info2").show()),k&&($("#isLocked3").hide(),$("#info3").show()),l&&($("#isLocked4").hide(),$("#info4").show()),loaded=!0}async function withdraw(){contractInstance.withdrawGains().send({feeLimit:1e7,callValue:0,shouldPollResponse:!0})}async function sellcookies(){contractInstance.sellCookies().send({feeLimit:1e7,callValue:0,shouldPollResponse:!0})}async function buyUnits(a,b,c){const d=tronWeb.address.toHex(c).substring(2);await fragInstance.approveAndCall(contractAddress,tronWeb.toHex(1e18*b),`0x00000000000000000000000000000000000000000000000000000000000000${a}000000000000000000000000${d}`).send({feeLimit:1e7,shouldPollResponse:!1,callValue:0})}async function sellUnits(a,b,c){await contractInstance.sellUnits(a,+(1e4*b),c).send({feeLimit:1e7,shouldPollResponse:!1,callValue:0})}async function isUnitUnlocked(a){const b=await contractInstance.isUnitUnlocked(a).call();return b}async function getReff(){const a=tronWeb.defaultAddress.base58,b=window.location.protocol+"//"+window.location.host+"/?ref=";copyToClipboard(b+a),alert("Refferal link copied")}function copyToClipboard(a){if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",a);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var b=document.createElement("textarea");b.textContent=a,b.style.position="fixed",document.body.appendChild(b),b.select();try{return document.execCommand("copy")}catch(a){return console.warn("Copy to clipboard failed.",a),!1}finally{document.body.removeChild(b)}}}function getUrlVars(){var a={},b=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d});return a}$(document).ready(function(){console.log("loaded"),$(".buyUnitField").each(function(a){var b=$(this);b.data("oldVal",b.val()),b.bind("propertychange change click keyup input paste",function(){b.data("oldVal")!=b.val()&&(b.data("oldVal",b.val()),updateBuyFields(b.val(),a))})}),$(".sellUnitField").each(function(a){var b=$(this);b.data("oldVal",b.val()),b.bind("propertychange change click keyup input paste",function(){b.data("oldVal")!=b.val()&&(b.data("oldVal",b.val()),updateSellFields(b.val(),a))})}),$("#Buy1").click(function(){const a=document.getElementById("BuyUnit1").value;buyUnits(0,a,refferal)}),$("#Buy2").click(function(){const a=document.getElementById("BuyUnit2").value;buyUnits(1,a,refferal)}),$("#Buy3").click(function(){const a=document.getElementById("BuyUnit3").value;buyUnits(2,a,refferal)}),$("#Buy4").click(function(){const a=document.getElementById("BuyUnit4").value;buyUnits(3,a,refferal)}),$("#Sell1").click(function(){const a=document.getElementById("SellUnit1").value;sellUnits(0,a,refferal)}),$("#Sell2").click(function(){const a=document.getElementById("SellUnit2").value;sellUnits(1,a,refferal)}),$("#Sell3").click(function(){const a=document.getElementById("SellUnit3").value;sellUnits(2,a,refferal)}),$("#Sell4").click(function(){const a=document.getElementById("SellUnit4").value;sellUnits(3,a,refferal)})});function updateBuyFields(a,b){const c=b+1,d=document.getElementById("BuyPriceUnit"+c).innerHTML;document.getElementById("BuyUnit"+c+"Recive").innerHTML=roundToTwo(a/d)}async function updateSellFields(a,b){const c=await contractInstance.getUnitPot(b).call(),d=.99*(c/1e18/(1e4*unitCount[b])*a*(100-(sellFee[b]+10))/100);document.getElementById("SellFragRecive"+(b+1)).innerHTML=roundToTwo(1e4*d)}
